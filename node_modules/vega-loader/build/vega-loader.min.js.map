{"version":3,"file":"vega-loader.min.js","sources":["../src/loader.js","../src/type.js","../../../node_modules/d3-dsv/src/dsv.js","../src/formats/dsv.js","../src/formats/json.js","../../../node_modules/topojson-client/src/identity.js","../../../node_modules/topojson-client/src/feature.js","../../../node_modules/topojson-client/src/transform.js","../../../node_modules/topojson-client/src/reverse.js","../../../node_modules/topojson-client/src/stitch.js","../../../node_modules/topojson-client/src/mesh.js","../src/formats/topojson.js","../src/formats/index.js","../index.browser.js","../src/read.js"],"sourcesContent":["import {error, extend, isFunction, stringValue} from 'vega-util';\n\n// Matches absolute URLs with optional protocol\n//   https://...    file://...    //...\nconst protocol_re = /^(data:|([A-Za-z]+:)?\\/\\/)/;\n\n// Matches allowed URIs. From https://github.com/cure53/DOMPurify/blob/master/src/regexp.js with added file://\nconst allowed_re = /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i; // eslint-disable-line no-useless-escape\nconst whitespace_re = /[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205f\\u3000]/g; // eslint-disable-line no-control-regex\n\n\n// Special treatment in node.js for the file: protocol\nconst fileProtocol = 'file://';\n\n/**\n * Factory for a loader constructor that provides methods for requesting\n * files from either the network or disk, and for sanitizing request URIs.\n * @param {function} fetch - The Fetch API for HTTP network requests.\n *   If null or undefined, HTTP loading will be disabled.\n * @param {object} fs - The file system interface for file loading.\n *   If null or undefined, local file loading will be disabled.\n * @return {function} A loader constructor with the following signature:\n *   param {object} [options] - Optional default loading options to use.\n *   return {object} - A new loader instance.\n */\nexport default function(fetch, fs) {\n  return options => ({\n    options: options || {},\n    sanitize: sanitize,\n    load: load,\n    fileAccess: !!fs,\n    file: fileLoader(fs),\n    http: httpLoader(fetch)\n  });\n}\n\n/**\n * Load an external resource, typically either from the web or from the local\n * filesystem. This function uses {@link sanitize} to first sanitize the uri,\n * then calls either {@link http} (for web requests) or {@link file} (for\n * filesystem loading).\n * @param {string} uri - The resource indicator (e.g., URL or filename).\n * @param {object} [options] - Optional loading options. These options will\n *   override any existing default options.\n * @return {Promise} - A promise that resolves to the loaded content.\n */\nasync function load(uri, options) {\n  const opt = await this.sanitize(uri, options),\n        url = opt.href;\n\n  return opt.localFile\n    ? this.file(url)\n    : this.http(url, options);\n}\n\n/**\n * URI sanitizer function.\n * @param {string} uri - The uri (url or filename) to check.\n * @param {object} options - An options hash.\n * @return {Promise} - A promise that resolves to an object containing\n *  sanitized uri data, or rejects it the input uri is deemed invalid.\n *  The properties of the resolved object are assumed to be\n *  valid attributes for an HTML 'a' tag. The sanitized uri *must* be\n *  provided by the 'href' property of the returned object.\n */\nasync function sanitize(uri, options) {\n  options = extend({}, this.options, options);\n\n  const fileAccess = this.fileAccess,\n        result = {href: null};\n\n  let isFile, loadFile, base;\n\n  const isAllowed = allowed_re.test(uri.replace(whitespace_re, ''));\n\n  if (uri == null || typeof uri !== 'string' || !isAllowed) {\n    error('Sanitize failure, invalid URI: ' + stringValue(uri));\n  }\n\n  const hasProtocol = protocol_re.test(uri);\n\n  // if relative url (no protocol/host), prepend baseURL\n  if ((base = options.baseURL) && !hasProtocol) {\n    // Ensure that there is a slash between the baseURL (e.g. hostname) and url\n    if (!uri.startsWith('/') && !base.endsWith('/')) {\n      uri = '/' + uri;\n    }\n    uri = base + uri;\n  }\n\n  // should we load from file system?\n  loadFile = (isFile = uri.startsWith(fileProtocol))\n    || options.mode === 'file'\n    || options.mode !== 'http' && !hasProtocol && fileAccess;\n\n  if (isFile) {\n    // strip file protocol\n    uri = uri.slice(fileProtocol.length);\n  } else if (uri.startsWith('//')) {\n    if (options.defaultProtocol === 'file') {\n      // if is file, strip protocol and set loadFile flag\n      uri = uri.slice(2);\n      loadFile = true;\n    } else {\n      // if relative protocol (starts with '//'), prepend default protocol\n      uri = (options.defaultProtocol || 'http') + ':' + uri;\n    }\n  }\n\n  // set non-enumerable mode flag to indicate local file load\n  Object.defineProperty(result, 'localFile', {value: !!loadFile});\n\n  // set uri\n  result.href = uri;\n\n  // set default result target, if specified\n  if (options.target) {\n    result.target = options.target + '';\n  }\n\n  // set default result rel, if specified (#1542)\n  if (options.rel) {\n    result.rel = options.rel + '';\n  }\n\n  // provide control over cross-origin image handling (#2238)\n  // https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image\n  if (options.context === 'image' && options.crossOrigin) {\n    result.crossOrigin = options.crossOrigin + '';\n  }\n\n  // return\n  return result;\n}\n\n/**\n * File system loader factory.\n * @param {object} fs - The file system interface.\n * @return {function} - A file loader with the following signature:\n *   param {string} filename - The file system path to load.\n *   param {string} filename - The file system path to load.\n *   return {Promise} A promise that resolves to the file contents.\n */\nfunction fileLoader(fs) {\n  return fs\n    ? filename => new Promise((accept, reject) => {\n        fs.readFile(filename, (error, data) => {\n          if (error) reject(error);\n          else accept(data);\n        });\n      })\n    : fileReject;\n}\n\n/**\n * Default file system loader that simply rejects.\n */\nasync function fileReject() {\n  error('No file system access.');\n}\n\n/**\n * HTTP request handler factory.\n * @param {function} fetch - The Fetch API method.\n * @return {function} - An http loader with the following signature:\n *   param {string} url - The url to request.\n *   param {object} options - An options hash.\n *   return {Promise} - A promise that resolves to the file contents.\n */\nfunction httpLoader(fetch) {\n  return fetch\n    ? async function(url, options) {\n        const opt = extend({}, this.options.http, options),\n              type = options && options.response,\n              response = await fetch(url, opt);\n\n        return !response.ok\n          ? error(response.status + '' + response.statusText)\n          : isFunction(response[type]) ? response[type]()\n          : response.text();\n      }\n    : httpReject;\n}\n\n/**\n * Default http request handler that simply rejects.\n */\nasync function httpReject() {\n  error('No HTTP fetch method available.');\n}\n","import {identity, toBoolean, toDate, toNumber, toString} from 'vega-util';\n\nconst isValid = _ => _ != null && _ === _;\n\nconst isBoolean = _ => _ === 'true'\n  || _ === 'false'\n  || _ === true\n  || _ === false;\n\nconst isDate = _ => !Number.isNaN(Date.parse(_));\n\nconst isNumber = _ => !Number.isNaN(+_) && !(_ instanceof Date);\n\nconst isInteger = _ => isNumber(_) && Number.isInteger(+_);\n\nexport const typeParsers = {\n  boolean: toBoolean,\n  integer: toNumber,\n  number:  toNumber,\n  date:    toDate,\n  string:  toString,\n  unknown: identity\n};\n\nconst typeTests = [\n  isBoolean,\n  isInteger,\n  isNumber,\n  isDate\n];\n\nconst typeList = [\n  'boolean',\n  'integer',\n  'number',\n  'date'\n];\n\nexport function inferType(values, field) {\n  if (!values || !values.length) return 'unknown';\n\n  const n = values.length,\n        m = typeTests.length,\n        a = typeTests.map((_, i) => i + 1);\n\n  for (let i = 0, t = 0, j, value; i < n; ++i) {\n    value = field ? values[i][field] : values[i];\n    for (j = 0; j < m; ++j) {\n      if (a[j] && isValid(value) && !typeTests[j](value)) {\n        a[j] = 0;\n        ++t;\n        if (t === typeTests.length) return 'string';\n      }\n    }\n  }\n\n  return typeList[\n    a.reduce((u, v) => u === 0 ? v : u, 0) - 1\n  ];\n}\n\nexport function inferTypes(data, fields) {\n  return fields.reduce((types, field) => {\n    types[field] = inferType(data, field);\n    return types;\n  }, {});\n}\n","var EOL = {},\n    EOF = {},\n    QUOTE = 34,\n    NEWLINE = 10,\n    RETURN = 13;\n\nfunction objectConverter(columns) {\n  return new Function(\"d\", \"return {\" + columns.map(function(name, i) {\n    return JSON.stringify(name) + \": d[\" + i + \"] || \\\"\\\"\";\n  }).join(\",\") + \"}\");\n}\n\nfunction customConverter(columns, f) {\n  var object = objectConverter(columns);\n  return function(row, i) {\n    return f(object(row), i, columns);\n  };\n}\n\n// Compute unique columns in order of discovery.\nfunction inferColumns(rows) {\n  var columnSet = Object.create(null),\n      columns = [];\n\n  rows.forEach(function(row) {\n    for (var column in row) {\n      if (!(column in columnSet)) {\n        columns.push(columnSet[column] = column);\n      }\n    }\n  });\n\n  return columns;\n}\n\nfunction pad(value, width) {\n  var s = value + \"\", length = s.length;\n  return length < width ? new Array(width - length + 1).join(0) + s : s;\n}\n\nfunction formatYear(year) {\n  return year < 0 ? \"-\" + pad(-year, 6)\n    : year > 9999 ? \"+\" + pad(year, 6)\n    : pad(year, 4);\n}\n\nfunction formatDate(date) {\n  var hours = date.getUTCHours(),\n      minutes = date.getUTCMinutes(),\n      seconds = date.getUTCSeconds(),\n      milliseconds = date.getUTCMilliseconds();\n  return isNaN(date) ? \"Invalid Date\"\n      : formatYear(date.getUTCFullYear(), 4) + \"-\" + pad(date.getUTCMonth() + 1, 2) + \"-\" + pad(date.getUTCDate(), 2)\n      + (milliseconds ? \"T\" + pad(hours, 2) + \":\" + pad(minutes, 2) + \":\" + pad(seconds, 2) + \".\" + pad(milliseconds, 3) + \"Z\"\n      : seconds ? \"T\" + pad(hours, 2) + \":\" + pad(minutes, 2) + \":\" + pad(seconds, 2) + \"Z\"\n      : minutes || hours ? \"T\" + pad(hours, 2) + \":\" + pad(minutes, 2) + \"Z\"\n      : \"\");\n}\n\nexport default function(delimiter) {\n  var reFormat = new RegExp(\"[\\\"\" + delimiter + \"\\n\\r]\"),\n      DELIMITER = delimiter.charCodeAt(0);\n\n  function parse(text, f) {\n    var convert, columns, rows = parseRows(text, function(row, i) {\n      if (convert) return convert(row, i - 1);\n      columns = row, convert = f ? customConverter(row, f) : objectConverter(row);\n    });\n    rows.columns = columns || [];\n    return rows;\n  }\n\n  function parseRows(text, f) {\n    var rows = [], // output rows\n        N = text.length,\n        I = 0, // current character index\n        n = 0, // current line number\n        t, // current token\n        eof = N <= 0, // current token followed by EOF?\n        eol = false; // current token followed by EOL?\n\n    // Strip the trailing newline.\n    if (text.charCodeAt(N - 1) === NEWLINE) --N;\n    if (text.charCodeAt(N - 1) === RETURN) --N;\n\n    function token() {\n      if (eof) return EOF;\n      if (eol) return eol = false, EOL;\n\n      // Unescape quotes.\n      var i, j = I, c;\n      if (text.charCodeAt(j) === QUOTE) {\n        while (I++ < N && text.charCodeAt(I) !== QUOTE || text.charCodeAt(++I) === QUOTE);\n        if ((i = I) >= N) eof = true;\n        else if ((c = text.charCodeAt(I++)) === NEWLINE) eol = true;\n        else if (c === RETURN) { eol = true; if (text.charCodeAt(I) === NEWLINE) ++I; }\n        return text.slice(j + 1, i - 1).replace(/\"\"/g, \"\\\"\");\n      }\n\n      // Find next delimiter or newline.\n      while (I < N) {\n        if ((c = text.charCodeAt(i = I++)) === NEWLINE) eol = true;\n        else if (c === RETURN) { eol = true; if (text.charCodeAt(I) === NEWLINE) ++I; }\n        else if (c !== DELIMITER) continue;\n        return text.slice(j, i);\n      }\n\n      // Return last token before EOF.\n      return eof = true, text.slice(j, N);\n    }\n\n    while ((t = token()) !== EOF) {\n      var row = [];\n      while (t !== EOL && t !== EOF) row.push(t), t = token();\n      if (f && (row = f(row, n++)) == null) continue;\n      rows.push(row);\n    }\n\n    return rows;\n  }\n\n  function preformatBody(rows, columns) {\n    return rows.map(function(row) {\n      return columns.map(function(column) {\n        return formatValue(row[column]);\n      }).join(delimiter);\n    });\n  }\n\n  function format(rows, columns) {\n    if (columns == null) columns = inferColumns(rows);\n    return [columns.map(formatValue).join(delimiter)].concat(preformatBody(rows, columns)).join(\"\\n\");\n  }\n\n  function formatBody(rows, columns) {\n    if (columns == null) columns = inferColumns(rows);\n    return preformatBody(rows, columns).join(\"\\n\");\n  }\n\n  function formatRows(rows) {\n    return rows.map(formatRow).join(\"\\n\");\n  }\n\n  function formatRow(row) {\n    return row.map(formatValue).join(delimiter);\n  }\n\n  function formatValue(value) {\n    return value == null ? \"\"\n        : value instanceof Date ? formatDate(value)\n        : reFormat.test(value += \"\") ? \"\\\"\" + value.replace(/\"/g, \"\\\"\\\"\") + \"\\\"\"\n        : value;\n  }\n\n  return {\n    parse: parse,\n    parseRows: parseRows,\n    format: format,\n    formatBody: formatBody,\n    formatRows: formatRows,\n    formatRow: formatRow,\n    formatValue: formatValue\n  };\n}\n","import {dsvFormat} from 'd3-dsv';\nimport {extend, stringValue} from 'vega-util';\n\nexport function delimitedFormat(delimiter) {\n  const parse = function(data, format) {\n    const delim = {delimiter: delimiter};\n    return dsv(data, format ? extend(format, delim) : delim);\n  };\n\n  parse.responseType = 'text';\n\n  return parse;\n}\n\nexport default function dsv(data, format) {\n  if (format.header) {\n    data = format.header\n      .map(stringValue)\n      .join(format.delimiter) + '\\n' + data;\n  }\n  return dsvFormat(format.delimiter).parse(data + '');\n}\n\ndsv.responseType = 'text';\n","import {\n  field, identity, isArray, isFunction, isIterable, isObject\n} from 'vega-util';\n\nfunction isBuffer(_) {\n  return (typeof Buffer === 'function' && isFunction(Buffer.isBuffer))\n    ? Buffer.isBuffer(_) : false;\n}\n\nexport default function json(data, format) {\n  const prop = (format && format.property) ? field(format.property) : identity;\n  return isObject(data) && !isBuffer(data)\n    ? parseJSON(prop(data), format)\n    : prop(JSON.parse(data));\n}\n\njson.responseType = 'json';\n\nfunction parseJSON(data, format) {\n  if (!isArray(data) && isIterable(data)) {\n    data = [...data];\n  }\n  return (format && format.copy)\n    ? JSON.parse(JSON.stringify(data))\n    : data;\n}\n","export default function(x) {\n  return x;\n}\n","import reverse from \"./reverse.js\";\nimport transform from \"./transform.js\";\n\nexport default function(topology, o) {\n  if (typeof o === \"string\") o = topology.objects[o];\n  return o.type === \"GeometryCollection\"\n      ? {type: \"FeatureCollection\", features: o.geometries.map(function(o) { return feature(topology, o); })}\n      : feature(topology, o);\n}\n\nfunction feature(topology, o) {\n  var id = o.id,\n      bbox = o.bbox,\n      properties = o.properties == null ? {} : o.properties,\n      geometry = object(topology, o);\n  return id == null && bbox == null ? {type: \"Feature\", properties: properties, geometry: geometry}\n      : bbox == null ? {type: \"Feature\", id: id, properties: properties, geometry: geometry}\n      : {type: \"Feature\", id: id, bbox: bbox, properties: properties, geometry: geometry};\n}\n\nexport function object(topology, o) {\n  var transformPoint = transform(topology.transform),\n      arcs = topology.arcs;\n\n  function arc(i, points) {\n    if (points.length) points.pop();\n    for (var a = arcs[i < 0 ? ~i : i], k = 0, n = a.length; k < n; ++k) {\n      points.push(transformPoint(a[k], k));\n    }\n    if (i < 0) reverse(points, n);\n  }\n\n  function point(p) {\n    return transformPoint(p);\n  }\n\n  function line(arcs) {\n    var points = [];\n    for (var i = 0, n = arcs.length; i < n; ++i) arc(arcs[i], points);\n    if (points.length < 2) points.push(points[0]); // This should never happen per the specification.\n    return points;\n  }\n\n  function ring(arcs) {\n    var points = line(arcs);\n    while (points.length < 4) points.push(points[0]); // This may happen if an arc has only two points.\n    return points;\n  }\n\n  function polygon(arcs) {\n    return arcs.map(ring);\n  }\n\n  function geometry(o) {\n    var type = o.type, coordinates;\n    switch (type) {\n      case \"GeometryCollection\": return {type: type, geometries: o.geometries.map(geometry)};\n      case \"Point\": coordinates = point(o.coordinates); break;\n      case \"MultiPoint\": coordinates = o.coordinates.map(point); break;\n      case \"LineString\": coordinates = line(o.arcs); break;\n      case \"MultiLineString\": coordinates = o.arcs.map(line); break;\n      case \"Polygon\": coordinates = polygon(o.arcs); break;\n      case \"MultiPolygon\": coordinates = o.arcs.map(polygon); break;\n      default: return null;\n    }\n    return {type: type, coordinates: coordinates};\n  }\n\n  return geometry(o);\n}\n","import identity from \"./identity.js\";\n\nexport default function(transform) {\n  if (transform == null) return identity;\n  var x0,\n      y0,\n      kx = transform.scale[0],\n      ky = transform.scale[1],\n      dx = transform.translate[0],\n      dy = transform.translate[1];\n  return function(input, i) {\n    if (!i) x0 = y0 = 0;\n    var j = 2, n = input.length, output = new Array(n);\n    output[0] = (x0 += input[0]) * kx + dx;\n    output[1] = (y0 += input[1]) * ky + dy;\n    while (j < n) output[j] = input[j], ++j;\n    return output;\n  };\n}\n","export default function(array, n) {\n  var t, j = array.length, i = j - n;\n  while (i < --j) t = array[i], array[i++] = array[j], array[j] = t;\n}\n","export default function(topology, arcs) {\n  var stitchedArcs = {},\n      fragmentByStart = {},\n      fragmentByEnd = {},\n      fragments = [],\n      emptyIndex = -1;\n\n  // Stitch empty arcs first, since they may be subsumed by other arcs.\n  arcs.forEach(function(i, j) {\n    var arc = topology.arcs[i < 0 ? ~i : i], t;\n    if (arc.length < 3 && !arc[1][0] && !arc[1][1]) {\n      t = arcs[++emptyIndex], arcs[emptyIndex] = i, arcs[j] = t;\n    }\n  });\n\n  arcs.forEach(function(i) {\n    var e = ends(i),\n        start = e[0],\n        end = e[1],\n        f, g;\n\n    if (f = fragmentByEnd[start]) {\n      delete fragmentByEnd[f.end];\n      f.push(i);\n      f.end = end;\n      if (g = fragmentByStart[end]) {\n        delete fragmentByStart[g.start];\n        var fg = g === f ? f : f.concat(g);\n        fragmentByStart[fg.start = f.start] = fragmentByEnd[fg.end = g.end] = fg;\n      } else {\n        fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n      }\n    } else if (f = fragmentByStart[end]) {\n      delete fragmentByStart[f.start];\n      f.unshift(i);\n      f.start = start;\n      if (g = fragmentByEnd[start]) {\n        delete fragmentByEnd[g.end];\n        var gf = g === f ? f : g.concat(f);\n        fragmentByStart[gf.start = g.start] = fragmentByEnd[gf.end = f.end] = gf;\n      } else {\n        fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n      }\n    } else {\n      f = [i];\n      fragmentByStart[f.start = start] = fragmentByEnd[f.end = end] = f;\n    }\n  });\n\n  function ends(i) {\n    var arc = topology.arcs[i < 0 ? ~i : i], p0 = arc[0], p1;\n    if (topology.transform) p1 = [0, 0], arc.forEach(function(dp) { p1[0] += dp[0], p1[1] += dp[1]; });\n    else p1 = arc[arc.length - 1];\n    return i < 0 ? [p1, p0] : [p0, p1];\n  }\n\n  function flush(fragmentByEnd, fragmentByStart) {\n    for (var k in fragmentByEnd) {\n      var f = fragmentByEnd[k];\n      delete fragmentByStart[f.start];\n      delete f.start;\n      delete f.end;\n      f.forEach(function(i) { stitchedArcs[i < 0 ? ~i : i] = 1; });\n      fragments.push(f);\n    }\n  }\n\n  flush(fragmentByEnd, fragmentByStart);\n  flush(fragmentByStart, fragmentByEnd);\n  arcs.forEach(function(i) { if (!stitchedArcs[i < 0 ? ~i : i]) fragments.push([i]); });\n\n  return fragments;\n}\n","import {object} from \"./feature.js\";\nimport stitch from \"./stitch.js\";\n\nexport default function(topology) {\n  return object(topology, meshArcs.apply(this, arguments));\n}\n\nexport function meshArcs(topology, object, filter) {\n  var arcs, i, n;\n  if (arguments.length > 1) arcs = extractArcs(topology, object, filter);\n  else for (i = 0, arcs = new Array(n = topology.arcs.length); i < n; ++i) arcs[i] = i;\n  return {type: \"MultiLineString\", arcs: stitch(topology, arcs)};\n}\n\nfunction extractArcs(topology, object, filter) {\n  var arcs = [],\n      geomsByArc = [],\n      geom;\n\n  function extract0(i) {\n    var j = i < 0 ? ~i : i;\n    (geomsByArc[j] || (geomsByArc[j] = [])).push({i: i, g: geom});\n  }\n\n  function extract1(arcs) {\n    arcs.forEach(extract0);\n  }\n\n  function extract2(arcs) {\n    arcs.forEach(extract1);\n  }\n\n  function extract3(arcs) {\n    arcs.forEach(extract2);\n  }\n\n  function geometry(o) {\n    switch (geom = o, o.type) {\n      case \"GeometryCollection\": o.geometries.forEach(geometry); break;\n      case \"LineString\": extract1(o.arcs); break;\n      case \"MultiLineString\": case \"Polygon\": extract2(o.arcs); break;\n      case \"MultiPolygon\": extract3(o.arcs); break;\n    }\n  }\n\n  geometry(object);\n\n  geomsByArc.forEach(filter == null\n      ? function(geoms) { arcs.push(geoms[0].i); }\n      : function(geoms) { if (filter(geoms[0].g, geoms[geoms.length - 1].g)) arcs.push(geoms[0].i); });\n\n  return arcs;\n}\n","import json from './json';\nimport {feature, mesh} from 'topojson-client';\nimport {error} from 'vega-util';\n\nconst filters = {\n  interior: (a, b) => a !== b,\n  exterior: (a, b) => a === b\n};\n\nexport default function topojson(data, format) {\n  let method, object, property, filter;\n  data = json(data, format);\n\n  if (format && format.feature) {\n    method = feature;\n    property = format.feature;\n  } else if (format && format.mesh) {\n    method = mesh;\n    property = format.mesh;\n    filter = filters[format.filter];\n  } else {\n    error('Missing TopoJSON feature or mesh parameter.');\n  }\n\n  object = (object = data.objects[property])\n    ? method(data, object, filter)\n    : error('Invalid TopoJSON object: ' + property);\n\n  return object && object.features || [object];\n}\n\ntopojson.responseType = 'json';\n","import {delimitedFormat, default as dsv} from './dsv';\nimport json from './json';\nimport topojson from './topojson';\nimport {hasOwnProperty} from 'vega-util';\n\nexport const format = {\n  dsv: dsv,\n  csv: delimitedFormat(','),\n  tsv: delimitedFormat('\\t'),\n  json: json,\n  topojson: topojson\n};\n\nexport function formats(name, reader) {\n  if (arguments.length > 1) {\n    format[name] = reader;\n    return this;\n  } else {\n    return hasOwnProperty(format, name) ? format[name] : null;\n  }\n}\n\nexport function responseType(type) {\n  const f = formats(type);\n  return f && f.responseType || 'text';\n}\n","import loaderFactory from './src/loader';\n\nexport const loader = loaderFactory(\n  typeof fetch !== 'undefined' && fetch, // use built-in fetch API\n  null // no file system access\n);\n\nexport {\n  default as read\n} from './src/read';\n\nexport {\n  inferType,\n  inferTypes,\n  typeParsers\n} from './src/type';\n\nexport {\n  format,\n  formats,\n  responseType\n} from './src/formats/index';\n","import {inferTypes, typeParsers} from './type';\nimport {formats} from './formats/index';\nimport {timeFormatDefaultLocale} from 'vega-format';\nimport {error, hasOwnProperty} from 'vega-util';\n\nexport default function(data, schema, timeParser, utcParser) {\n  schema = schema || {};\n\n  const reader = formats(schema.type || 'json');\n  if (!reader) error('Unknown data format type: ' + schema.type);\n\n  data = reader(data, schema);\n  if (schema.parse) parse(data, schema.parse, timeParser, utcParser);\n\n  if (hasOwnProperty(data, 'columns')) delete data.columns;\n  return data;\n}\n\nfunction parse(data, types, timeParser, utcParser) {\n  if (!data.length) return; // early exit for empty data\n\n  const locale = timeFormatDefaultLocale();\n  timeParser = timeParser || locale.timeParse;\n  utcParser = utcParser || locale.utcParse;\n\n  let fields = data.columns || Object.keys(data[0]),\n      datum, field, i, j, n, m;\n\n  if (types === 'auto') types = inferTypes(data, fields);\n\n  fields = Object.keys(types);\n  const parsers = fields.map(field => {\n    const type = types[field];\n    let parts, pattern;\n\n    if (type && (type.startsWith('date:') || type.startsWith('utc:'))) {\n      parts = type.split(/:(.+)?/, 2);  // split on first :\n      pattern = parts[1];\n\n      if ((pattern[0] === '\\'' && pattern[pattern.length-1] === '\\'') ||\n          (pattern[0] === '\"'  && pattern[pattern.length-1] === '\"')) {\n        pattern = pattern.slice(1, -1);\n      }\n\n      const parse = parts[0] === 'utc' ? utcParser : timeParser;\n      return parse(pattern);\n    }\n\n    if (!typeParsers[type]) {\n      throw Error('Illegal format pattern: ' + field + ':' + type);\n    }\n\n    return typeParsers[type];\n  });\n\n  for (i=0, n=data.length, m=fields.length; i<n; ++i) {\n    datum = data[i];\n    for (j=0; j<m; ++j) {\n      field = fields[j];\n      datum[field] = parsers[j](datum[field]);\n    }\n  }\n}\n"],"names":["protocol_re","allowed_re","whitespace_re","fileProtocol","async","load","uri","options","opt","this","sanitize","url","href","localFile","file","http","extend","fileAccess","result","isFile","loadFile","base","isAllowed","test","replace","error","stringValue","hasProtocol","baseURL","startsWith","endsWith","mode","slice","length","defaultProtocol","Object","defineProperty","value","target","rel","context","crossOrigin","fileLoader","fs","fileReject","httpLoader","fetch","type","response","ok","isFunction","text","status","statusText","httpReject","isValid","_","isNumber","Number","isNaN","Date","typeParsers","boolean","toBoolean","integer","toNumber","number","date","toDate","string","toString","unknown","identity","typeTests","isInteger","parse","typeList","inferType","values","field","n","m","a","map","i","j","t","reduce","u","v","inferTypes","data","fields","types","EOL","EOF","QUOTE","NEWLINE","RETURN","objectConverter","columns","Function","name","JSON","stringify","join","inferColumns","rows","columnSet","create","forEach","row","column","push","pad","width","s","Array","formatDate","year","hours","getUTCHours","minutes","getUTCMinutes","seconds","getUTCSeconds","milliseconds","getUTCMilliseconds","getUTCFullYear","getUTCMonth","getUTCDate","dsvFormat","delimiter","reFormat","RegExp","DELIMITER","charCodeAt","parseRows","f","N","I","eof","eol","token","c","preformatBody","formatValue","formatRow","convert","object","customConverter","format","concat","formatBody","formatRows","delimitedFormat","delim","dsv","responseType","header","json","prop","property","isObject","Buffer","isBuffer","isArray","isIterable","copy","parseJSON","x","feature","topology","o","objects","features","geometries","id","bbox","properties","geometry","transformPoint","transform","x0","y0","kx","scale","ky","dx","translate","dy","input","output","arcs","arc","points","pop","k","array","reverse","point","p","line","ring","polygon","coordinates","stitch","stitchedArcs","fragmentByStart","fragmentByEnd","fragments","emptyIndex","flush","start","end","g","e","p1","p0","dp","ends","fg","unshift","gf","mesh","meshArcs","apply","arguments","filter","geom","geomsByArc","extract0","extract1","extract2","extract3","geoms","extractArcs","filters","interior","b","exterior","topojson","method","csv","tsv","formats","reader","hasOwnProperty","loader","loaderFactory","schema","timeParser","utcParser","locale","timeFormatDefaultLocale","timeParse","utcParse","datum","keys","parsers","parts","pattern","split","Error"],"mappings":"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","x_google_ignoreList":[2,5,6,7,8,9,10]}